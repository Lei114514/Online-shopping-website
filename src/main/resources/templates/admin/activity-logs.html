<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>用戶活動日誌 - 線上購物系統</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="container-fluid mt-4">
            <div class="row mb-4">
                <div class="col">
                    <h2><i class="fas fa-history me-2"></i>用戶活動日誌</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a th:href="@{/}">首頁</a></li>
                            <li class="breadcrumb-item"><a th:href="@{/admin}">管理員儀表板</a></li>
                            <li class="breadcrumb-item active">活動日誌</li>
                        </ol>
                    </nav>
                </div>
            </div>
            
            <!--篩選 -->
            <div class="card mb-4">
                <div class="card-body">
                    <form th:action="@{/admin/activity-logs}" method="get" class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">活動類型</label>
                            <select class="form-select" name="activityType">
                                <option value="">所有類型</option>
                                <option value="LOGIN" th:selected="${selectedActivityType == 'LOGIN'}">登入</option>
                                <option value="LOGOUT" th:selected="${selectedActivityType == 'LOGOUT'}">登出</option>
                                <option value="VIEW_PRODUCT" th:selected="${selectedActivityType == 'VIEW_PRODUCT'}">瀏覽商品</option>
                                <option value="ADD_TO_CART" th:selected="${selectedActivityType == 'ADD_TO_CART'}">加入購物車</option>
                                <option value="PLACE_ORDER" th:selected="${selectedActivityType == 'PLACE_ORDER'}">下單</option>
                                <option value="SEARCH" th:selected="${selectedActivityType == 'SEARCH'}">搜索</option>
                                <option value="REGISTER" th:selected="${selectedActivityType == 'REGISTER'}">註冊</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">用戶</label>
                            <select class="form-select" name="userId">
                                <option value="">所有用戶</option>
                                <option th:each="user : ${users}"
                                        th:value="${user.id}" 
                                        th:text="${user.username + ' (' + user.fullName + ')'}"
                                        th:selected="${user.id == selectedUserId}"></option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">時間範圍</label>
                            <select class="form-select" name="days">
                                <option value="">全部</option>
                                <option value="1" th:selected="${selectedDays == 1}">今天</option>
                                <option value="7" th:selected="${selectedDays == 7}">最近7天</option>
                                <option value="30" th:selected="${selectedDays == 30}">最近30天</option>
                                <option value="90" th:selected="${selectedDays == 90}">最近90天</option>
                            </select>
                        </div>
                        <div class="col-md-3d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-filter me-1"></i>篩選
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- 活動日誌列表 -->
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">活動記錄 (共 <span th:text="${#lists.size(logs)}">0</span> 條)</h5>
                        <a th:href="@{/admin/statistics}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-chart-bar me-1"></i>查看統計
                        </a>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 5%">ID</th>
                                    <th style="width: 15%">用戶</th>
                                    <th style="width: 12%">活動類型</th>
                                    <th style="width: 35%">活動詳情</th>
                                    <th style="width: 13%">IP地址</th>
                                    <th style="width: 20%">時間</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="log : ${logs}">
                                    <td th:text="${log.id}"></td>
                                    <td>
                                        <div th:if="${log.user != null}">
                                            <a th:href="@{/admin/customers/{id}(id=${log.user.id})}"
                                               th:text="${log.user.username}"
                                               class="text-decoration-none">
                                </a>
                                            <br>
                                            <small class="text-muted" th:text="${log.user.fullName}"></small>
                                        </div>
                                        <span th:if="${log.user == null}" class="text-muted">匿名用戶</span>
                                    </td>
                                    <td>
                                        <span th:class="'badge bg-' + ${log.activityType == 'LOGIN' ? 'success' :log.activityType == 'LOGOUT' ? 'secondary' :
                                                                        log.activityType == 'PLACE_ORDER' ? 'primary' :
                                                                        log.activityType == 'VIEW_PRODUCT' ? 'info' :
                                                                        log.activityType == 'ADD_TO_CART' ? 'warning' :
                                                                        log.activityType == 'REGISTER' ? 'success' : 'secondary'}"th:text="${log.activityType}">
                                        </span>
                                    </td>
                                    <td>
                                        <small th:text="${log.activityDetails}"></small>
                                    </td>
                                    <td>
                                        <small class="text-muted">
                                            <i class="fas fa-globe me-1"></i>
                                            <span th:text="${log.ipAddress ?: '-'}"></span>
                                        </small>
                                    </td>
                                    <td>
                                        <small th:text="${#temporals.format(log.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></small>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(logs)}">
                                    <td colspan="6" class="text-center text-muted py-5">
                                        <i class="fas fa-history fa-3x d-block mb-3"></i>
                                        <h5>沒有找到活動記錄</h5>
                                        <p>嘗試調整篩選條件</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-white text-muted" th:if="${!#lists.isEmpty(logs)}">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        顯示最近 <span th:text="${#lists.size(logs)}"></span> 條活動記錄
                    </small>
                </div>
            </div>
            
            <!-- 活動類型說明 -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>活動類型說明</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-success">LOGIN</span> - 用戶登入系統
                        </div>
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-secondary">LOGOUT</span> - 用戶登出系統
                        </div>
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-info">VIEW_PRODUCT</span> - 瀏覽商品詳情
                        </div>
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-warning">ADD_TO_CART</span> - 添加商品到購物車
                        </div>
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-secondary">REMOVE_FROM_CART</span> - 從購物車移除商品
                        </div>
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-primary">PLACE_ORDER</span> - 下訂單
                        </div>
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-secondary">SEARCH</span> - 搜索商品
                        </div>
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-success">REGISTER</span> - 註冊新帳戶
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>