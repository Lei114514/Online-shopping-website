<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}"><head>
    <title>管理員儀表板 - 線上購物系統</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="container-fluid mt-4">
            <div class="row mb-4">
                <div class="col">
                    <h2><i class="fas fa-tachometer-alt me-2"></i>管理員儀表板</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a th:href="@{/}">首頁</a></li>
                            <li class="breadcrumb-item active">管理員儀表板</li>
                        </ol>
                    </nav>
                </div>
            </div>
            
            <!-- 統計卡片 -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-1">總用戶數</h6>
                                    <h3 class="mb-0" th:text="${totalUsers}">0</h3>
                                </div>
                                <i class="fas fa-users fa-3x opacity-50"></i>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent border-top-0"><a th:href="@{/admin/customers}" class="text-white text-decoration-none">
                                <small>查看詳情 <i class="fas fa-arrow-right"></i></small>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3 mb-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-1">總訂單數</h6>
                                    <h3 class="mb-0" th:text="${totalOrders}">0</h3>
                                </div>
                                <i class="fas fa-shopping-cart fa-3x opacity-50"></i>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a th:href="@{/admin/orders}" class="text-white text-decoration-none">
                                <small>查看詳情 <i class="fas fa-arrow-right"></i></small>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3 mb-3">
                    <div class="card bg-warning text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-1">待處理訂單</h6>
                                    <h3 class="mb-0" th:text="${pendingOrders}">0</h3>
                                </div>
                                <i class="fas fa-clock fa-3x opacity-50"></i>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a th:href="@{/admin/orders(status='PENDING')}" class="text-white text-decoration-none">
                                <small>查看詳情 <i class="fas fa-arrow-right"></i></small>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3 mb-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-1">處理中訂單</h6>
                                    <h3 class="mb-0" th:text="${processingOrders}">0</h3>
                                </div>
                                <i class="fas fa-spinner fa-3x opacity-50"></i>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a th:href="@{/admin/orders(status='PROCESSING')}" class="text-white text-decoration-none">
                                <small>查看詳情 <i class="fas fa-arrow-right"></i></small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 快速導航 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-dark text-white">
                            <h5 class="mb-0"><i class="fas fa-link me-2"></i>快速導航</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <a th:href="@{/admin/customers}" class="btn btn-outline-primary w-100 py-3">
                                        <i class="fas fa-users fa-2x d-block mb-2"></i>
                                        客戶管理
                                    </a>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <a th:href="@{/admin/orders}" class="btn btn-outline-success w-100 py-3">
                                        <i class="fas fa-shopping-bag fa-2x d-block mb-2"></i>
                                        訂單管理
                                    </a>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <a th:href="@{/admin/activity-logs}" class="btn btn-outline-info w-100 py-3">
                                        <i class="fas fa-history fa-2x d-block mb-2"></i>
                                        活動日誌
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><div class="row">
                <!-- 最近訂單 -->
                <div class="col-md-8 mb-4">
                    <div class="card">
                        <div class="card-header bg-white">
                            <h5 class="mb-0"><i class="fas fa-list me-2"></i>最近訂單</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>訂單編號</th>
                                            <th>客戶</th>
                                            <th>金額</th>
                                            <th>狀態</th>
                                            <th>日期</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="order : ${recentOrders}">
                                            <td>
                                                <a th:href="@{/admin/orders/{id}(id=${order.id})}" 
                                                   th:text="${order.orderNumber}"
                                                   class="text-decoration-none">
                                </a>
                                            </td>
                                            <td th:text="${order.user.fullName}"></td>
                                            <td th:text="'$' + ${order.totalAmount}"></td>
                                            <td>
                                                <span th:class="'badge bg-' + ${order.status == T(com.onlineshop.model.Order$OrderStatus).PENDING ? 'warning' :order.status == T(com.onlineshop.model.Order$OrderStatus).PROCESSING ? 'info' :
                                                                                  order.status == T(com.onlineshop.model.Order$OrderStatus).SHIPPED ? 'primary' :
                                                                                  order.status == T(com.onlineshop.model.Order$OrderStatus).DELIVERED ? 'success' : 'danger'}"
                                                      th:text="${order.status}">
                                                </span>
                                            </td>
                                            <td th:text="${#temporals.format(order.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                                            <td>
                                                <a th:href="@{/admin/orders/{id}(id=${order.id})}" 
                                                   class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr th:if="${#lists.isEmpty(recentOrders)}">
                                            <td colspan="6" class="text-center text-muted py-4">
                                                <i class="fas fa-inbox fa-2x d-block mb-2"></i>
                                                暫無訂單
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 最近活動 -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-header bg-white">
                            <h5 class="mb-0"><i class="fas fa-bell me-2"></i>最近活動</h5>
                        </div>
                        <div class="card-body p-0" style="max-height: 500px; overflow-y: auto;">
                            <div class="list-group list-group-flush">
                                <div th:each="activity : ${recentActivities}" 
                                     class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <small class="mb-1">
                                            <i class="fas fa-user-circle me-1"></i>
                                            <strong th:text="${activity.user != null ? activity.user.username : '匿名'}"></strong>
                                        </small>
                                        <small class="text-muted"
                                               th:text="${#temporals.format(activity.createdAt, 'HH:mm')}"></small>
                                    </div>
                                    <small class="mb-1 d-block">
                                        <span th:class="'badge bg-' + ${activity.activityType == 'LOGIN' ? 'success' :activity.activityType == 'PLACE_ORDER' ? 'primary' :
                                                                        activity.activityType == 'VIEW_PRODUCT' ? 'info' : 'secondary'}"
                                              th:text="${activity.activityType}">
                                        </span>
                                    </small>
                                    <small class="text-muted" th:text="${activity.activityDetails}"></small>
                                </div>
                                <div th:if="${#lists.isEmpty(recentActivities)}" 
                                     class="list-group-item text-center text-muted py-4">
                                    <i class="fas fa-inbox fa-2x d-block mb-2"></i>
                                    暫無活動記錄
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-white text-center">
                            <a th:href="@{/admin/activity-logs}" class="btn btn-sm btn-outline-primary">
                                查看所有活動 <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>